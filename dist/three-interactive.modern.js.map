{"version":3,"file":"three-interactive.modern.js","sources":["../src/index.js"],"sourcesContent":["import { Raycaster, Vector2 } from 'three';\n\nexport class InteractiveObject {\n  constructor(target, name) {\n    this.target = target;\n    this.name = name;\n    this.intersected = false;\n    this.distance = 0;\n  }\n}\n\nexport class InteractiveEvent {\n  constructor(type, originalEvent = null) {\n    this.cancelBubble = false;\n    this.type = type;\n    this.originalEvent = originalEvent;\n  }\n  stopPropagation() {\n    this.cancelBubble = true;\n  }\n}\n\nexport class InteractionManager {\n  constructor(renderer, camera, domElement) {\n    this.renderer = renderer;\n    this.camera = camera;\n    this.domElement = domElement;\n\n    this.mouse = new Vector2();\n\n    this.interactiveObjects = [];\n\n    this.raycaster = new Raycaster();\n\n    domElement.addEventListener('mousemove', this.onDocumentMouseMove, false);\n    domElement.addEventListener('click', this.onDocumentMouseClick, false);\n    domElement.addEventListener('mousedown', this.onDocumentMouseDown, false);\n    domElement.ownerDocument.addEventListener(\n      'mouseup',\n      this.onDocumentMouseUp,\n      false\n    );\n\n    domElement.addEventListener('touchstart', this.onDocumentTouchStart, false);\n    domElement.addEventListener('touchmove', this.onDocumentTouchMove, false);\n    domElement.addEventListener('touchend', this.onDocumentTouchEnd, false);\n\n    this.treatTouchEventsAsMouseEvents = true;\n  }\n\n  dispose = () => {\n    domElement.removeEventListener('mousemove', this.onDocumentMouseMove);\n    domElement.removeEventListener('click', this.onDocumentMouseClick);\n    domElement.removeEventListener('mousedown', this.onDocumentMouseDown);\n    domElement.ownerDocument.removeEventListener(\n      'mouseup',\n      this.onDocumentMouseUp\n    );\n\n    domElement.removeEventListener('touchstart', this.onDocumentTouchStart);\n    domElement.removeEventListener('touchmove', this.onDocumentTouchMove);\n    domElement.removeEventListener('touchend', this.onDocumentTouchEnd);\n  };\n\n  add = (model, names = []) => {\n    if (names.length > 0) {\n      names.forEach((name) => {\n        const modelObject = model.getObjectByName(name);\n        if (modelObject) {\n          const interactiveObject = new InteractiveObject(modelObject, name);\n          this.interactiveObjects.push(interactiveObject);\n        }\n      });\n    } else {\n      if (model) {\n        const interactiveObject = new InteractiveObject(model, model.name);\n        this.interactiveObjects.push(interactiveObject);\n      }\n    }\n  };\n\n  remove = (model, names = []) => {\n    if (names.length > 0) {\n      const interactiveObjectsNew = [];\n      this.interactiveObjects.forEach((object) => {\n        if (!names.includes(object.name)) {\n          interactiveObjectsNew.push(object);\n        }\n      });\n      this.interactiveObjects = interactiveObjectsNew;\n    } else {\n      if (model) {\n        const interactiveObjectsNew = [];\n        this.interactiveObjects.forEach((object) => {\n          if (object.name !== model.name) {\n            interactiveObjectsNew.push(object);\n          }\n        });\n        this.interactiveObjects = interactiveObjectsNew;\n      }\n    }\n  };\n\n  update = () => {\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n\n    // console.log( scene.children );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.target) this.checkIntersection(object);\n    });\n\n    this.interactiveObjects.sort(function (a, b) {\n      return a.distance - b.distance;\n    });\n\n    const eventOut = new InteractiveEvent('mouseout');\n    this.interactiveObjects.forEach((object) => {\n      if (!object.intersected && object.wasIntersected) {\n        this.dispatch(object, eventOut);\n      }\n    });\n    const eventOver = new InteractiveEvent('mouseover');\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected && !object.wasIntersected) {\n        this.dispatch(object, eventOver);\n      }\n    });\n  };\n\n  checkIntersection = (object) => {\n    var intersects = this.raycaster.intersectObjects([object.target], true);\n\n    object.wasIntersected = object.intersected;\n\n    if (intersects.length > 0) {\n      let distance = intersects[0].distance;\n      intersects.forEach((i) => {\n        if (i.distance < distance) {\n          distance = i.distance;\n        }\n      });\n      object.intersected = true;\n      object.distance = distance;\n    } else {\n      object.intersected = false;\n    }\n  };\n\n  onDocumentMouseMove = (mouseEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(this.mouse, mouseEvent.clientX, mouseEvent.clientY);\n\n    const event = new InteractiveEvent('mousemove', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentTouchMove = (touchEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousemove' : 'touchmove',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentMouseClick = (mouseEvent) => {\n    this.update();\n\n    const event = new InteractiveEvent('click', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentMouseDown = (mouseEvent) => {\n    this.update();\n\n    const event = new InteractiveEvent('mousedown', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentTouchStart = (touchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousedown' : 'touchstart',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentMouseUp = (mouseEvent) => {\n    const event = new InteractiveEvent('mouseup', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentTouchEnd = (touchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mouseup' : 'touchend',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  dispatch = (object, event) => {\n    if (object.target && !event.cancelBubble) {\n      event.coords = this.mouse;\n      event.distance = object.distance;\n      event.intersected = object.intersected;\n      object.target.dispatchEvent(event);\n    }\n  };\n\n  mapPositionToPoint = (point, x, y) => {\n    let rect;\n\n    // IE 11 fix\n    if (!this.renderer.domElement.parentElement) {\n      rect = {\n        x: 0,\n        y: 0,\n        left: 0,\n        top: 0,\n        width: 0,\n        height: 0,\n      };\n    } else {\n      rect = this.renderer.domElement.getBoundingClientRect();\n    }\n\n    point.x = ((x - rect.left) / rect.width) * 2 - 1;\n    point.y = -((y - rect.top) / rect.height) * 2 + 1;\n  };\n}\n"],"names":["InteractiveObject","constructor","target","name","this","intersected","distance","InteractiveEvent","type","originalEvent","cancelBubble","stopPropagation","InteractionManager","renderer","camera","domElement","dispose","removeEventListener","onDocumentMouseMove","onDocumentMouseClick","onDocumentMouseDown","ownerDocument","onDocumentMouseUp","onDocumentTouchStart","onDocumentTouchMove","onDocumentTouchEnd","add","model","names","length","forEach","modelObject","getObjectByName","interactiveObject","interactiveObjects","push","remove","interactiveObjectsNew","object","includes","update","raycaster","setFromCamera","mouse","checkIntersection","sort","a","b","eventOut","wasIntersected","dispatch","eventOver","intersects","intersectObjects","i","mouseEvent","mapPositionToPoint","clientX","clientY","event","touchEvent","touches","treatTouchEventsAsMouseEvents","coords","dispatchEvent","point","x","y","rect","parentElement","getBoundingClientRect","left","top","width","height","Vector2","Raycaster","addEventListener"],"mappings":"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"}