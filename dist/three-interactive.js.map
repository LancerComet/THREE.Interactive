{"version":3,"file":"three-interactive.js","sources":["../src/index.js"],"sourcesContent":["import { Raycaster, Vector2 } from 'three';\n\nexport class InteractiveObject {\n  constructor(target, name) {\n    this.target = target;\n    this.name = name;\n    this.intersected = false;\n    this.distance = 0;\n  }\n}\n\nexport class InteractiveEvent {\n  constructor(type, originalEvent = null) {\n    this.cancelBubble = false;\n    this.type = type;\n    this.originalEvent = originalEvent;\n  }\n  stopPropagation() {\n    this.cancelBubble = true;\n  }\n}\n\nexport class InteractionManager {\n  constructor(renderer, camera, domElement) {\n    this.renderer = renderer;\n    this.camera = camera;\n    this.domElement = domElement;\n\n    this.mouse = new Vector2();\n\n    this.interactiveObjects = [];\n\n    this.raycaster = new Raycaster();\n\n    domElement.addEventListener('mousemove', this.onDocumentMouseMove, false);\n    domElement.addEventListener('click', this.onDocumentMouseClick, false);\n    domElement.addEventListener('mousedown', this.onDocumentMouseDown, false);\n    domElement.ownerDocument.addEventListener(\n      'mouseup',\n      this.onDocumentMouseUp,\n      false\n    );\n\n    domElement.addEventListener('touchstart', this.onDocumentTouchStart, false);\n    domElement.addEventListener('touchmove', this.onDocumentTouchMove, false);\n    domElement.addEventListener('touchend', this.onDocumentTouchEnd, false);\n\n    this.treatTouchEventsAsMouseEvents = true;\n  }\n\n  dispose = () => {\n    domElement.removeEventListener('mousemove', this.onDocumentMouseMove);\n    domElement.removeEventListener('click', this.onDocumentMouseClick);\n    domElement.removeEventListener('mousedown', this.onDocumentMouseDown);\n    domElement.ownerDocument.removeEventListener(\n      'mouseup',\n      this.onDocumentMouseUp\n    );\n\n    domElement.removeEventListener('touchstart', this.onDocumentTouchStart);\n    domElement.removeEventListener('touchmove', this.onDocumentTouchMove);\n    domElement.removeEventListener('touchend', this.onDocumentTouchEnd);\n  };\n\n  add = (model, names = []) => {\n    if (names.length > 0) {\n      names.forEach((name) => {\n        const modelObject = model.getObjectByName(name);\n        if (modelObject) {\n          const interactiveObject = new InteractiveObject(modelObject, name);\n          this.interactiveObjects.push(interactiveObject);\n        }\n      });\n    } else {\n      if (model) {\n        const interactiveObject = new InteractiveObject(model, model.name);\n        this.interactiveObjects.push(interactiveObject);\n      }\n    }\n  };\n\n  remove = (model, names = []) => {\n    if (names.length > 0) {\n      const interactiveObjectsNew = [];\n      this.interactiveObjects.forEach((object) => {\n        if (!names.includes(object.name)) {\n          interactiveObjectsNew.push(object);\n        }\n      });\n      this.interactiveObjects = interactiveObjectsNew;\n    } else {\n      if (model) {\n        const interactiveObjectsNew = [];\n        this.interactiveObjects.forEach((object) => {\n          if (object.name !== model.name) {\n            interactiveObjectsNew.push(object);\n          }\n        });\n        this.interactiveObjects = interactiveObjectsNew;\n      }\n    }\n  };\n\n  update = () => {\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n\n    // console.log( scene.children );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.target) this.checkIntersection(object);\n    });\n\n    this.interactiveObjects.sort(function (a, b) {\n      return a.distance - b.distance;\n    });\n\n    const eventOut = new InteractiveEvent('mouseout');\n    this.interactiveObjects.forEach((object) => {\n      if (!object.intersected && object.wasIntersected) {\n        this.dispatch(object, eventOut);\n      }\n    });\n    const eventOver = new InteractiveEvent('mouseover');\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected && !object.wasIntersected) {\n        this.dispatch(object, eventOver);\n      }\n    });\n  };\n\n  checkIntersection = (object) => {\n    var intersects = this.raycaster.intersectObjects([object.target], true);\n\n    object.wasIntersected = object.intersected;\n\n    if (intersects.length > 0) {\n      let distance = intersects[0].distance;\n      intersects.forEach((i) => {\n        if (i.distance < distance) {\n          distance = i.distance;\n        }\n      });\n      object.intersected = true;\n      object.distance = distance;\n    } else {\n      object.intersected = false;\n    }\n  };\n\n  onDocumentMouseMove = (mouseEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(this.mouse, mouseEvent.clientX, mouseEvent.clientY);\n\n    const event = new InteractiveEvent('mousemove', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentTouchMove = (touchEvent) => {\n    // event.preventDefault();\n\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousemove' : 'touchmove',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentMouseClick = (mouseEvent) => {\n    this.update();\n\n    const event = new InteractiveEvent('click', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentMouseDown = (mouseEvent) => {\n    this.update();\n\n    const event = new InteractiveEvent('mousedown', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentTouchStart = (touchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mousedown' : 'touchstart',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      if (object.intersected) {\n        this.dispatch(object, event);\n      }\n    });\n  };\n\n  onDocumentMouseUp = (mouseEvent) => {\n    const event = new InteractiveEvent('mouseup', mouseEvent);\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  onDocumentTouchEnd = (touchEvent) => {\n    this.mapPositionToPoint(\n      this.mouse,\n      touchEvent.touches[0].clientX,\n      touchEvent.touches[0].clientY\n    );\n\n    this.update();\n\n    const event = new InteractiveEvent(\n      this.treatTouchEventsAsMouseEvents ? 'mouseup' : 'touchend',\n      touchEvent\n    );\n\n    this.interactiveObjects.forEach((object) => {\n      this.dispatch(object, event);\n    });\n  };\n\n  dispatch = (object, event) => {\n    if (object.target && !event.cancelBubble) {\n      event.coords = this.mouse;\n      event.distance = object.distance;\n      event.intersected = object.intersected;\n      object.target.dispatchEvent(event);\n    }\n  };\n\n  mapPositionToPoint = (point, x, y) => {\n    let rect;\n\n    // IE 11 fix\n    if (!this.renderer.domElement.parentElement) {\n      rect = {\n        x: 0,\n        y: 0,\n        left: 0,\n        top: 0,\n        width: 0,\n        height: 0,\n      };\n    } else {\n      rect = this.renderer.domElement.getBoundingClientRect();\n    }\n\n    point.x = ((x - rect.left) / rect.width) * 2 - 1;\n    point.y = -((y - rect.top) / rect.height) * 2 + 1;\n  };\n}\n"],"names":["InteractiveObject","target","name","this","intersected","distance","InteractiveEvent","type","originalEvent","cancelBubble","stopPropagation","renderer","camera","domElement","dispose","removeEventListener","_this","onDocumentMouseMove","onDocumentMouseClick","onDocumentMouseDown","ownerDocument","onDocumentMouseUp","onDocumentTouchStart","onDocumentTouchMove","onDocumentTouchEnd","add","model","names","length","forEach","modelObject","getObjectByName","interactiveObject","interactiveObjects","push","remove","interactiveObjectsNew","object","includes","update","raycaster","setFromCamera","mouse","checkIntersection","sort","a","b","eventOut","wasIntersected","dispatch","eventOver","intersects","intersectObjects","i","mouseEvent","mapPositionToPoint","clientX","clientY","event","touchEvent","touches","treatTouchEventsAsMouseEvents","coords","dispatchEvent","point","x","y","rect","parentElement","getBoundingClientRect","left","top","width","height","Vector2","Raycaster","addEventListener"],"mappings":"uBAEaA,EACX,SAAYC,EAAQC,GAClBC,KAAKF,OAASA,EACdE,KAAKD,KAAOA,EACZC,KAAKC,aAAc,EACnBD,KAAKE,SAAW,GAIPC,aACX,WAAYC,EAAMC,YAAAA,IAAAA,EAAgB,MAChCL,KAAKM,cAAe,EACpBN,KAAKI,KAAOA,EACZJ,KAAKK,cAAgBA,qBAEvBE,gBAAA,WACEP,KAAKM,cAAe,mCAKtB,SAAYE,EAAUC,EAAQC,mBA2B9BC,QAAU,WACRD,WAAWE,oBAAoB,YAAaC,EAAKC,qBACjDJ,WAAWE,oBAAoB,QAASC,EAAKE,sBAC7CL,WAAWE,oBAAoB,YAAaC,EAAKG,qBACjDN,WAAWO,cAAcL,oBACvB,UACAC,EAAKK,mBAGPR,WAAWE,oBAAoB,aAAcC,EAAKM,sBAClDT,WAAWE,oBAAoB,YAAaC,EAAKO,qBACjDV,WAAWE,oBAAoB,WAAYC,EAAKQ,0BAGlDC,IAAM,SAACC,EAAOC,GACZ,YADYA,IAAAA,EAAQ,IAChBA,EAAMC,OAAS,EACjBD,EAAME,QAAQ,SAAC3B,GACb,IAAM4B,EAAcJ,EAAMK,gBAAgB7B,GAC1C,GAAI4B,EAAa,CACf,IAAME,EAAoB,IAAIhC,EAAkB8B,EAAa5B,GAC7Dc,EAAKiB,mBAAmBC,KAAKF,WAIjC,GAAIN,EAAO,CACT,IAAMM,EAAoB,IAAIhC,EAAkB0B,EAAOA,EAAMxB,MAC7Dc,EAAKiB,mBAAmBC,KAAKF,UAKnCG,OAAS,SAACT,EAAOC,GACf,YADeA,IAAAA,EAAQ,IACnBA,EAAMC,OAAS,EAAG,CACpB,IAAMQ,EAAwB,GAC9BpB,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC1BV,EAAMW,SAASD,EAAOnC,OACzBkC,EAAsBF,KAAKG,KAG/BrB,EAAKiB,mBAAqBG,OAE1B,GAAIV,EAAO,CACT,IAAMU,EAAwB,GAC9BpB,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOnC,OAASwB,EAAMxB,MACxBkC,EAAsBF,KAAKG,KAG/BrB,EAAKiB,mBAAqBG,SAKhCG,OAAS,WACPvB,EAAKwB,UAAUC,cAAczB,EAAK0B,MAAO1B,EAAKJ,QAI9CI,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOpC,QAAQe,EAAK2B,kBAAkBN,KAG5CrB,EAAKiB,mBAAmBW,KAAK,SAAUC,EAAGC,GACxC,OAAOD,EAAExC,SAAWyC,EAAEzC,WAGxB,IAAM0C,EAAW,IAAIzC,EAAiB,YACtCU,EAAKiB,mBAAmBJ,QAAQ,SAACQ,IAC1BA,EAAOjC,aAAeiC,EAAOW,gBAChChC,EAAKiC,SAASZ,EAAQU,KAG1B,IAAMG,EAAY,IAAI5C,EAAiB,aACvCU,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOjC,cAAgBiC,EAAOW,gBAChChC,EAAKiC,SAASZ,EAAQa,WAK5BP,kBAAoB,SAACN,GACnB,IAAIc,EAAanC,EAAKwB,UAAUY,iBAAiB,CAACf,EAAOpC,SAAS,GAIlE,GAFAoC,EAAOW,eAAiBX,EAAOjC,YAE3B+C,EAAWvB,OAAS,EAAG,CACzB,IAAIvB,EAAW8C,EAAW,GAAG9C,SAC7B8C,EAAWtB,QAAQ,SAACwB,GACdA,EAAEhD,SAAWA,IACfA,EAAWgD,EAAEhD,YAGjBgC,EAAOjC,aAAc,EACrBiC,EAAOhC,SAAWA,OAElBgC,EAAOjC,aAAc,QAIzBa,oBAAsB,SAACqC,GAGrBtC,EAAKuC,mBAAmBvC,EAAK0B,MAAOY,EAAWE,QAASF,EAAWG,SAEnE,IAAMC,EAAQ,IAAIpD,EAAiB,YAAagD,GAEhDtC,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC/BrB,EAAKiC,SAASZ,EAAQqB,WAI1BnC,oBAAsB,SAACoC,GAGrB3C,EAAKuC,mBACHvC,EAAK0B,MACLiB,EAAWC,QAAQ,GAAGJ,QACtBG,EAAWC,QAAQ,GAAGH,SAGxB,IAAMC,EAAQ,IAAIpD,EAChBU,EAAK6C,8BAAgC,YAAc,YACnDF,GAGF3C,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC/BrB,EAAKiC,SAASZ,EAAQqB,WAI1BxC,qBAAuB,SAACoC,GACtBtC,EAAKuB,SAEL,IAAMmB,EAAQ,IAAIpD,EAAiB,QAASgD,GAE5CtC,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOjC,aACTY,EAAKiC,SAASZ,EAAQqB,WAK5BvC,oBAAsB,SAACmC,GACrBtC,EAAKuB,SAEL,IAAMmB,EAAQ,IAAIpD,EAAiB,YAAagD,GAEhDtC,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOjC,aACTY,EAAKiC,SAASZ,EAAQqB,WAK5BpC,qBAAuB,SAACqC,GACtB3C,EAAKuC,mBACHvC,EAAK0B,MACLiB,EAAWC,QAAQ,GAAGJ,QACtBG,EAAWC,QAAQ,GAAGH,SAGxBzC,EAAKuB,SAEL,IAAMmB,EAAQ,IAAIpD,EAChBU,EAAK6C,8BAAgC,YAAc,aACnDF,GAGF3C,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC3BA,EAAOjC,aACTY,EAAKiC,SAASZ,EAAQqB,WAK5BrC,kBAAoB,SAACiC,GACnB,IAAMI,EAAQ,IAAIpD,EAAiB,UAAWgD,GAE9CtC,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC/BrB,EAAKiC,SAASZ,EAAQqB,WAI1BlC,mBAAqB,SAACmC,GACpB3C,EAAKuC,mBACHvC,EAAK0B,MACLiB,EAAWC,QAAQ,GAAGJ,QACtBG,EAAWC,QAAQ,GAAGH,SAGxBzC,EAAKuB,SAEL,IAAMmB,EAAQ,IAAIpD,EAChBU,EAAK6C,8BAAgC,UAAY,WACjDF,GAGF3C,EAAKiB,mBAAmBJ,QAAQ,SAACQ,GAC/BrB,EAAKiC,SAASZ,EAAQqB,WAI1BT,SAAW,SAACZ,EAAQqB,GACdrB,EAAOpC,SAAWyD,EAAMjD,eAC1BiD,EAAMI,OAAS9C,EAAK0B,MACpBgB,EAAMrD,SAAWgC,EAAOhC,SACxBqD,EAAMtD,YAAciC,EAAOjC,YAC3BiC,EAAOpC,OAAO8D,cAAcL,UAIhCH,mBAAqB,SAACS,EAAOC,EAAGC,GAC9B,IAAIC,EAaFA,EAVGnD,EAAKL,SAASE,WAAWuD,cAUrBpD,EAAKL,SAASE,WAAWwD,wBATzB,CACLJ,EAAG,EACHC,EAAG,EACHI,KAAM,EACNC,IAAK,EACLC,MAAO,EACPC,OAAQ,GAMZT,EAAMC,GAAMA,EAAIE,EAAKG,MAAQH,EAAKK,MAAS,EAAI,EAC/CR,EAAME,IAAOA,EAAIC,EAAKI,KAAOJ,EAAKM,OAAU,EAAI,GA/PhDtE,KAAKQ,SAAWA,EAChBR,KAAKS,OAASA,EACdT,KAAKU,WAAaA,EAElBV,KAAKuC,MAAQ,IAAIgC,UAEjBvE,KAAK8B,mBAAqB,GAE1B9B,KAAKqC,UAAY,IAAImC,YAErB9D,EAAW+D,iBAAiB,YAAazE,KAAKc,qBAAqB,GACnEJ,EAAW+D,iBAAiB,QAASzE,KAAKe,sBAAsB,GAChEL,EAAW+D,iBAAiB,YAAazE,KAAKgB,qBAAqB,GACnEN,EAAWO,cAAcwD,iBACvB,UACAzE,KAAKkB,mBACL,GAGFR,EAAW+D,iBAAiB,aAAczE,KAAKmB,sBAAsB,GACrET,EAAW+D,iBAAiB,YAAazE,KAAKoB,qBAAqB,GACnEV,EAAW+D,iBAAiB,WAAYzE,KAAKqB,oBAAoB,GAEjErB,KAAK0D,+BAAgC"}